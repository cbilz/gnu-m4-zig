const std = @import("std");
const InsertHeaderSnippet = @import("InsertHeaderSnippet.zig");

pub fn build(b: *std.Build) void {
    const upstream = b.dependency("upstream", .{});

    const include = b.addWriteFiles();
    b.installDirectory(.{
        .source_dir = include.getDirectory(),
        .install_dir = .header,
        .install_subdir = "",
    });

    addCopyConfigHeader(
        include,
        "config.h",
        .{ .autoconf = upstream.path("lib/config.hin") },
        config_h_values,
    );

    addCopyConfigHeader(
        include,
        "alloca.h",
        .{ .cmake = upstream.path("lib/alloca.in.h") },
        .{ .HAVE_ALLOCA_H = HAVE_ALLOCA_H },
    );

    // The macros defined in `configmake.h` are unused since we disable native language support.
    addCopyConfigHeader(include, "configmake.h", .blank, .{});

    const dirent_in_h = upstream.path("lib/dirent.in.h");
    const dirent_1_h = include.step.owner.addConfigHeader(
        .{ .style = .{ .cmake = dirent_in_h } },
        dirent_h_values,
    );
    // This should be fixed in ConfigHeader, see:
    // https://github.com/ziglang/zig/issues/16208
    dirent_in_h.addStepDependencies(&dirent_1_h.step);

    const dirent_2_h = InsertHeaderSnippet.create(b, .{
        .source_file = dirent_1_h.getOutput(),
        .snippet_file = upstream.path("lib/c++defs.h"),
        .line_pattern = "definitions of _GL_FUNCDECL_RPL",
    });

    const dirent_3_h = InsertHeaderSnippet.create(b, .{
        .source_file = dirent_2_h.getOutput(),
        .snippet_file = upstream.path("lib/arg-nonnull.h"),
        .line_pattern = "definition of _GL_ARG_NONNULL",
    });

    const dirent_h = InsertHeaderSnippet.create(b, .{
        .source_file = dirent_3_h.getOutput(),
        .snippet_file = upstream.path("lib/warn-on-use.h"),
        .line_pattern = "definition of _GL_WARN_ON_USE",
    });

    _ = include.addCopyFile(dirent_h.getOutput(), "dirent.h");

    const check = b.step("check", "Check if GNU M4 compiles");
    check.dependOn(&include.step);
}

fn addCopyConfigHeader(
    write_file: *std.Build.Step.WriteFile,
    sub_path: []const u8,
    style: std.Build.Step.ConfigHeader.Style,
    values: anytype,
) void {
    const header = write_file.step.owner.addConfigHeader(
        .{ .style = style, .include_path = sub_path },
        values,
    );
    // This should be fixed in ConfigHeader.
    if (style.getPath()) |lp| lp.addStepDependencies(&header.step);
    _ = write_file.addCopyFile(header.getOutput(), sub_path);
}

// The version of GNU M4 that we build.
const version = blk: {
    // Ideally, the package version should be accessible via `std.Build` in the future, eliminating
    // the need to process `build.zig.zon` here.
    const src = @embedFile("build.zig.zon");
    // Unable to use `std.zig.Ast.parse` at comptime, so string matching is used as an alternative.
    const needle = " .version = \"";
    const pos = (std.mem.indexOf(u8, src, needle) orelse break :blk "") + needle.len;
    const len = std.mem.indexOfScalar(u8, src[pos..], '"') orelse break :blk "";
    break :blk src[pos..][0..len];
};

const GNULIB_FDOPENDIR = 1;
const HAVE_ALLOCA_H = 1;
const HAVE_CLOSEDIR = 1;
const HAVE_DECL_DIRFD = 1;
const HAVE_DECL_FDOPENDIR = 1;
const HAVE_DIRENT_H = 1;
const HAVE_FDOPENDIR = 1;
const HAVE_OPENDIR = 1;
const HAVE_READDIR = 1;
const HAVE_REWINDDIR = 1;

const config_h_values = .{
    .@"inline" = null,
    .AC_APPLE_UNIVERSAL_BUILD = null,
    .BITSIZEOF_PTRDIFF_T = null,
    .BITSIZEOF_SIG_ATOMIC_T = null,
    .BITSIZEOF_SIZE_T = null,
    .BITSIZEOF_WCHAR_T = null,
    .BITSIZEOF_WINT_T = null,
    .CHECK_PRINTF_SAFE = 1,
    .C_ALLOCA = null,
    .DBL_EXPBIT0_BIT = 20,
    .DBL_EXPBIT0_WORD = 1,
    .DBL_SIGNBIT_BIT = null,
    .DBL_SIGNBIT_WORD = null,
    .DIR_FD_MEMBER_NAME = null,
    .DOUBLE_SLASH_IS_DISTINCT_ROOT = null,
    .D_INO_IN_DIRENT = 1,
    .ENABLE_CHANGEWORD = null,
    .ENABLE_NLS = null,
    .FCNTL_DUPFD_BUGGY = null,
    .FLEXIBLE_ARRAY_MEMBER = {},
    .FLT_EXPBIT0_BIT = 23,
    .FLT_EXPBIT0_WORD = 0,
    .FLT_SIGNBIT_BIT = null,
    .FLT_SIGNBIT_WORD = null,
    .FOPEN_TRAILING_SLASH_BUG = null,
    .FTELLO_BROKEN_AFTER_SWITCHING_FROM_READ_TO_WRITE = null,
    .FTELLO_BROKEN_AFTER_UNGETC = null,
    .FUNC_FFLUSH_STDIN = 0,
    .FUNC_MKDIR_DOT_BUG = null,
    .FUNC_NL_LANGINFO_YESEXPR_WORKS = 1,
    .FUNC_REALPATH_NEARLY_WORKS = null,
    .FUNC_REALPATH_WORKS = 1,
    .FUNC_UNGETC_BROKEN = null,
    .GETTIMEOFDAY_TIMEZONE = .void,
    .GNULIB_CANONICALIZE = 1,
    .GNULIB_CANONICALIZE_LGPL = 1,
    .GNULIB_CLOSE_STREAM = 1,
    .GNULIB_DIRNAME = 1,
    .GNULIB_FDOPENDIR = GNULIB_FDOPENDIR,
    .GNULIB_FD_SAFER_FLAG = 1,
    .GNULIB_FFLUSH = 1,
    .GNULIB_FILENAMECAT = 1,
    .GNULIB_FOPEN_GNU = 1,
    .GNULIB_FOPEN_SAFER = 1,
    .GNULIB_FSCANF = 1,
    .GNULIB_GETCWD = 1,
    .GNULIB_ISBLANK = .IN_M4_GNULIB_TESTS,
    .GNULIB_LOCK = 1,
    .GNULIB_MBRTOWC_SINGLE_THREAD = 1,
    .GNULIB_MSVC_NOTHROW = 1,
    .GNULIB_OPENAT = 1,
    .GNULIB_PIPE2_SAFER = 1,
    .GNULIB_PRINTF_ATTRIBUTE_FLAVOR_GNU = null,
    .GNULIB_REALLOCARRAY = 1,
    .GNULIB_REGEX_SINGLE_THREAD = 1,
    .GNULIB_SCANF = 1,
    .GNULIB_SIGPIPE = 1,
    .GNULIB_SNPRINTF = 1,
    .GNULIB_STDIO_SINGLE_THREAD = 1,
    .GNULIB_STRERROR = 1,
    .GNULIB_STRERROR_R_POSIX = .IN_M4_GNULIB_TESTS,
    .GNULIB_TEMPNAME = 1,
    .GNULIB_TEST_ACCEPT = 1,
    .GNULIB_TEST_ACCESS = 1,
    .GNULIB_TEST_BIND = 1,
    .GNULIB_TEST_BTOWC = 1,
    .GNULIB_TEST_CALLOC_POSIX = 1,
    .GNULIB_TEST_CANONICALIZE = 1,
    .GNULIB_TEST_CANONICALIZE_FILE_NAME = 1,
    .GNULIB_TEST_CHDIR = 1,
    .GNULIB_TEST_CLOEXEC = 1,
    .GNULIB_TEST_CLOSE = 1,
    .GNULIB_TEST_CLOSEDIR = 1,
    .GNULIB_TEST_CONNECT = 1,
    .GNULIB_TEST_CREAT = 1,
    .GNULIB_TEST_DIRFD = 1,
    .GNULIB_TEST_DUP = 1,
    .GNULIB_TEST_DUP2 = 1,
    .GNULIB_TEST_ENVIRON = 1,
    .GNULIB_TEST_EXPLICIT_BZERO = 1,
    .GNULIB_TEST_FCHDIR = 1,
    .GNULIB_TEST_FCLOSE = 1,
    .GNULIB_TEST_FCNTL = 1,
    .GNULIB_TEST_FDOPEN = 1,
    .GNULIB_TEST_FDOPENDIR = 1,
    .GNULIB_TEST_FFLUSH = 1,
    .GNULIB_TEST_FGETC = 1,
    .GNULIB_TEST_FGETS = 1,
    .GNULIB_TEST_FOPEN = 1,
    .GNULIB_TEST_FPRINTF = 1,
    .GNULIB_TEST_FPURGE = 1,
    .GNULIB_TEST_FPUTC = 1,
    .GNULIB_TEST_FPUTS = 1,
    .GNULIB_TEST_FREAD = 1,
    .GNULIB_TEST_FREE_POSIX = 1,
    .GNULIB_TEST_FREOPEN = 1,
    .GNULIB_TEST_FREXP = 1,
    .GNULIB_TEST_FREXPL = 1,
    .GNULIB_TEST_FSCANF = 1,
    .GNULIB_TEST_FSEEK = 1,
    .GNULIB_TEST_FSEEKO = 1,
    .GNULIB_TEST_FSTAT = 1,
    .GNULIB_TEST_FSTATAT = 1,
    .GNULIB_TEST_FTELL = 1,
    .GNULIB_TEST_FTELLO = 1,
    .GNULIB_TEST_FTRUNCATE = 1,
    .GNULIB_TEST_FWRITE = 1,
    .GNULIB_TEST_GETC = 1,
    .GNULIB_TEST_GETCHAR = 1,
    .GNULIB_TEST_GETCWD = 1,
    .GNULIB_TEST_GETDTABLESIZE = 1,
    .GNULIB_TEST_GETOPT_POSIX = 1,
    .GNULIB_TEST_GETPAGESIZE = 1,
    .GNULIB_TEST_GETRANDOM = 1,
    .GNULIB_TEST_GETTIMEOFDAY = 1,
    .GNULIB_TEST_IOCTL = 1,
    .GNULIB_TEST_ISWBLANK = 1,
    .GNULIB_TEST_ISWDIGIT = 1,
    .GNULIB_TEST_ISWXDIGIT = 1,
    .GNULIB_TEST_LINK = 1,
    .GNULIB_TEST_LISTEN = 1,
    .GNULIB_TEST_LOCALECONV = 1,
    .GNULIB_TEST_LOCALENAME = 1,
    .GNULIB_TEST_LSEEK = 1,
    .GNULIB_TEST_LSTAT = 1,
    .GNULIB_TEST_MALLOC_POSIX = 1,
    .GNULIB_TEST_MBRTOWC = 1,
    .GNULIB_TEST_MBSINIT = 1,
    .GNULIB_TEST_MBSLEN = 1,
    .GNULIB_TEST_MBSSTR = 1,
    .GNULIB_TEST_MBTOWC = 1,
    .GNULIB_TEST_MEMCHR = 1,
    .GNULIB_TEST_MEMPCPY = 1,
    .GNULIB_TEST_MEMRCHR = 1,
    .GNULIB_TEST_MKDIR = 1,
    .GNULIB_TEST_MKDTEMP = 1,
    .GNULIB_TEST_MKSTEMP = 1,
    .GNULIB_TEST_NANOSLEEP = 1,
    .GNULIB_TEST_NL_LANGINFO = 1,
    .GNULIB_TEST_OPEN = 1,
    .GNULIB_TEST_OPENAT = 1,
    .GNULIB_TEST_OPENDIR = 1,
    .GNULIB_TEST_PERROR = 1,
    .GNULIB_TEST_PIPE = 1,
    .GNULIB_TEST_PIPE2 = 1,
    .GNULIB_TEST_POSIX_SPAWN = 1,
    .GNULIB_TEST_POSIX_SPAWNATTR_DESTROY = 1,
    .GNULIB_TEST_POSIX_SPAWNATTR_INIT = 1,
    .GNULIB_TEST_POSIX_SPAWNATTR_SETFLAGS = 1,
    .GNULIB_TEST_POSIX_SPAWNATTR_SETPGROUP = 1,
    .GNULIB_TEST_POSIX_SPAWNATTR_SETSIGMASK = 1,
    .GNULIB_TEST_POSIX_SPAWNP = 1,
    .GNULIB_TEST_POSIX_SPAWN_FILE_ACTIONS_ADDCHDIR = 1,
    .GNULIB_TEST_POSIX_SPAWN_FILE_ACTIONS_ADDCLOSE = 1,
    .GNULIB_TEST_POSIX_SPAWN_FILE_ACTIONS_ADDDUP2 = 1,
    .GNULIB_TEST_POSIX_SPAWN_FILE_ACTIONS_ADDOPEN = 1,
    .GNULIB_TEST_POSIX_SPAWN_FILE_ACTIONS_DESTROY = 1,
    .GNULIB_TEST_POSIX_SPAWN_FILE_ACTIONS_INIT = 1,
    .GNULIB_TEST_PRINTF = 1,
    .GNULIB_TEST_PTHREAD_SIGMASK = 1,
    .GNULIB_TEST_PTHREAD_THREAD = 1,
    .GNULIB_TEST_PUTC = 1,
    .GNULIB_TEST_PUTCHAR = 1,
    .GNULIB_TEST_PUTENV = 1,
    .GNULIB_TEST_PUTS = 1,
    .GNULIB_TEST_RAISE = 1,
    .GNULIB_TEST_RAWMEMCHR = 1,
    .GNULIB_TEST_READDIR = 1,
    .GNULIB_TEST_READLINK = 1,
    .GNULIB_TEST_REALLOCARRAY = 1,
    .GNULIB_TEST_REALLOC_POSIX = 1,
    .GNULIB_TEST_REALPATH = 1,
    .GNULIB_TEST_RENAME = 1,
    .GNULIB_TEST_REWINDDIR = 1,
    .GNULIB_TEST_RMDIR = 1,
    .GNULIB_TEST_SCANF = 1,
    .GNULIB_TEST_SCHED_YIELD = 1,
    .GNULIB_TEST_SECURE_GETENV = 1,
    .GNULIB_TEST_SELECT = 1,
    .GNULIB_TEST_SETENV = 1,
    .GNULIB_TEST_SETLOCALE = 1,
    .GNULIB_TEST_SETLOCALE_NULL = 1,
    .GNULIB_TEST_SETSOCKOPT = 1,
    .GNULIB_TEST_SIGACTION = 1,
    .GNULIB_TEST_SIGNBIT = 1,
    .GNULIB_TEST_SIGPROCMASK = 1,
    .GNULIB_TEST_SLEEP = 1,
    .GNULIB_TEST_SNPRINTF = 1,
    .GNULIB_TEST_SOCKET = 1,
    .GNULIB_TEST_STAT = 1,
    .GNULIB_TEST_STPCPY = 1,
    .GNULIB_TEST_STRCHRNUL = 1,
    .GNULIB_TEST_STRDUP = 1,
    .GNULIB_TEST_STRERROR = 1,
    .GNULIB_TEST_STRERROR_R = 1,
    .GNULIB_TEST_STRNDUP = 1,
    .GNULIB_TEST_STRNLEN = 1,
    .GNULIB_TEST_STRSIGNAL = 1,
    .GNULIB_TEST_STRSTR = 1,
    .GNULIB_TEST_STRTOD = 1,
    .GNULIB_TEST_SYMLINK = 1,
    .GNULIB_TEST_UNSETENV = 1,
    .GNULIB_TEST_VASPRINTF = 1,
    .GNULIB_TEST_VFPRINTF = 1,
    .GNULIB_TEST_VPRINTF = 1,
    .GNULIB_TEST_WAITPID = 1,
    .GNULIB_TEST_WCRTOMB = 1,
    .GNULIB_TEST_WCTOB = 1,
    .GNULIB_TEST_WCTOMB = 1,
    .GNULIB_TEST_WCWIDTH = 1,
    .GNULIB_TEST_WRITE = 1,
    .GNULIB_UNISTR_U8_MBTOUCR = 1,
    .GNULIB_UNISTR_U8_UCTOMB = 1,
    .GNULIB_WCHAR_SINGLE_LOCALE = 1,
    .GNULIB_XALLOC = 1,
    .GNULIB_XALLOC_DIE = 1,
    .HAVE_ALLOCA = 1,
    .HAVE_ALLOCA_H = HAVE_ALLOCA_H,
    .HAVE_ARPA_INET_H = 1,
    .HAVE_BCRYPT_H = null,
    .HAVE_BP_SYM_H = null,
    .HAVE_BTOWC = 1,
    .HAVE_BUG_BIG_NANOSLEEP = 1,
    .HAVE_CANONICALIZE_FILE_NAME = 1,
    .HAVE_CATGETS = 1,
    .HAVE_CFLOCALECOPYPREFERREDLANGUAGES = null,
    .HAVE_CFPREFERENCESCOPYAPPVALUE = null,
    .HAVE_CLOCK_GETTIME = 1,
    .HAVE_CLOCK_SETTIME = 1,
    .HAVE_CLOSEDIR = HAVE_CLOSEDIR,
    .HAVE_CLOSE_RANGE = 1,
    .HAVE_CONFSTR = null,
    .HAVE_COPYSIGNF_IN_LIBC = null,
    .HAVE_COPYSIGNL_IN_LIBC = null,
    .HAVE_COPYSIGN_IN_LIBC = null,
    .HAVE_CRTDEFS_H = null,
    .HAVE_DCGETTEXT = null,
    .HAVE_DECL_ALARM = 1,
    .HAVE_DECL_CLEARERR_UNLOCKED = 1,
    .HAVE_DECL_COPYSIGN = null,
    .HAVE_DECL_COPYSIGNF = null,
    .HAVE_DECL_COPYSIGNL = null,
    .HAVE_DECL_DIRFD = HAVE_DECL_DIRFD,
    .HAVE_DECL_ECVT = 1,
    .HAVE_DECL_EXECVPE = 1,
    .HAVE_DECL_FCHDIR = 1,
    .HAVE_DECL_FCLOSEALL = 1,
    .HAVE_DECL_FCVT = 1,
    .HAVE_DECL_FDOPENDIR = HAVE_DECL_FDOPENDIR,
    .HAVE_DECL_FEOF_UNLOCKED = 1,
    .HAVE_DECL_FERROR_UNLOCKED = 1,
    .HAVE_DECL_FFLUSH_UNLOCKED = 1,
    .HAVE_DECL_FGETS_UNLOCKED = 1,
    .HAVE_DECL_FPURGE = 0,
    .HAVE_DECL_FPUTC_UNLOCKED = 1,
    .HAVE_DECL_FPUTS_UNLOCKED = 1,
    .HAVE_DECL_FREAD_UNLOCKED = 1,
    .HAVE_DECL_FSEEKO = 1,
    .HAVE_DECL_FTELLO = 1,
    .HAVE_DECL_FWRITE_UNLOCKED = 1,
    .HAVE_DECL_GCVT = 1,
    .HAVE_DECL_GETCHAR_UNLOCKED = 1,
    .HAVE_DECL_GETCWD = 1,
    .HAVE_DECL_GETC_UNLOCKED = 1,
    .HAVE_DECL_GETDTABLESIZE = 1,
    .HAVE_DECL_INET_PTON = 1,
    .HAVE_DECL_ISBLANK = 1,
    .HAVE_DECL_ISWBLANK = 1,
    .HAVE_DECL_MBRTOWC = null,
    .HAVE_DECL_MBSINIT = null,
    .HAVE_DECL_MEMRCHR = 1,
    .HAVE_DECL_POSIX_SPAWN = 1,
    .HAVE_DECL_PROGRAM_INVOCATION_NAME = 1,
    .HAVE_DECL_PROGRAM_INVOCATION_SHORT_NAME = 1,
    .HAVE_DECL_PUTCHAR_UNLOCKED = 1,
    .HAVE_DECL_PUTC_UNLOCKED = 1,
    .HAVE_DECL_SETENV = 1,
    .HAVE_DECL_SLEEP = 1,
    .HAVE_DECL_SNPRINTF = 1,
    .HAVE_DECL_STRDUP = 1,
    .HAVE_DECL_STRERROR_R = 1,
    .HAVE_DECL_STRNDUP = 1,
    .HAVE_DECL_STRNLEN = 1,
    .HAVE_DECL_STRSIGNAL = 1,
    .HAVE_DECL_SYS_SIGLIST = null,
    .HAVE_DECL_TOWLOWER = null,
    .HAVE_DECL_UNSETENV = 1,
    .HAVE_DECL_WCRTOMB = null,
    .HAVE_DECL_WCSDUP = 1,
    .HAVE_DECL_WCTOB = 1,
    .HAVE_DECL_WCWIDTH = 1,
    .HAVE_DECL__FSEEKI64 = null,
    .HAVE_DECL__PUTENV = null,
    .HAVE_DECL__SNPRINTF = 0,
    .HAVE_DECL__SYS_SIGLIST = null,
    .HAVE_DECL___ARGV = 0,
    .HAVE_DECL___FPENDING = 1,
    .HAVE_DIRENT_H = HAVE_DIRENT_H,
    .HAVE_DIRFD = 1,
    .HAVE_DUPLOCALE = 1,
    .HAVE_ENVIRON_DECL = 1,
    .HAVE_EXPLICIT_BZERO = 1,
    .HAVE_EXPLICIT_MEMSET = null,
    .HAVE_FACCESSAT = 1,
    .HAVE_FAKE_LOCALES = null,
    .HAVE_FCHDIR = 1,
    .HAVE_FCNTL = 1,
    .HAVE_FDOPENDIR = HAVE_FDOPENDIR,
    .HAVE_FEATURES_H = 1,
    .HAVE_FPURGE = null,
    .HAVE_FREELOCALE = 1,
    .HAVE_FREE_POSIX = 1,
    .HAVE_FREXPL_IN_LIBC = 1,
    .HAVE_FREXP_IN_LIBC = 1,
    .HAVE_FSEEKO = 1,
    .HAVE_FSTATAT = 1,
    .HAVE_FTRUNCATE = 1,
    .HAVE_GETCWD = 1,
    .HAVE_GETCWD_SHORTER = null,
    .HAVE_GETDTABLESIZE = 1,
    .HAVE_GETEGID = 1,
    .HAVE_GETEUID = 1,
    .HAVE_GETEXECNAME = null,
    .HAVE_GETGID = 1,
    .HAVE_GETLOCALENAME_L = null,
    .HAVE_GETOPT_H = 1,
    .HAVE_GETOPT_LONG_ONLY = 1,
    .HAVE_GETPAGESIZE = null,
    .HAVE_GETPROGNAME = null,
    .HAVE_GETRANDOM = 1,
    .HAVE_GETRLIMIT = 1,
    .HAVE_GETTEXT = null,
    .HAVE_GETTIMEOFDAY = 1,
    .HAVE_GETUID = 1,
    .HAVE_GOOD_USELOCALE = 1,
    .HAVE_ICONV = 1,
    .HAVE_ICONV_H = 1,
    .HAVE_INET_PTON = null,
    .HAVE_INLINE = 1,
    .HAVE_INTMAX_T = 1,
    .HAVE_INTTYPES_H = 1,
    .HAVE_INTTYPES_H_WITH_UINTMAX = 1,
    .HAVE_IOCTL = 1,
    .HAVE_IPV4 = 1,
    .HAVE_IPV6 = 1,
    .HAVE_ISBLANK = 1,
    .HAVE_ISNAND_IN_LIBC = 1,
    .HAVE_ISNANF_IN_LIBC = 1,
    .HAVE_ISNANL_IN_LIBC = 1,
    .HAVE_ISSETUGID = null,
    .HAVE_ISWBLANK = 1,
    .HAVE_ISWCNTRL = 1,
    .HAVE_ISWCTYPE = 1,
    .HAVE_LANGINFO_CODESET = 1,
    .HAVE_LANGINFO_H = 1,
    .HAVE_LC_MESSAGES = 1,
    .HAVE_LDEXPL_IN_LIBC = 1,
    .HAVE_LDEXP_IN_LIBC = 1,
    .HAVE_LIBINTL_H = 1,
    .HAVE_LIBSIGSEGV = null,
    .HAVE_LIB_BCRYPT = null,
    .HAVE_LIMITS_H = 1,
    .HAVE_LINK = 1,
    .HAVE_LONG_LONG_INT = 1,
    .HAVE_LSTAT = 1,
    .HAVE_MALLOC_H = 1,
    .HAVE_MALLOC_POSIX = 1,
    .HAVE_MAP_ANONYMOUS = 1,
    .HAVE_MATH_H = 1,
    .HAVE_MBRTOWC = 1,
    .HAVE_MBSINIT = 1,
    .HAVE_MBSLEN = null,
    .HAVE_MBSTATE_T = 1,
    .HAVE_MBTOWC = 1,
    .HAVE_MEMPCPY = 1,
    .HAVE_MEMRCHR = 1,
    .HAVE_MEMSET_S = null,
    .HAVE_MINIMALLY_WORKING_GETCWD = 1,
    .HAVE_MINIX_CONFIG_H = null,
    .HAVE_MINMAX_IN_LIMITS_H = null,
    .HAVE_MINMAX_IN_SYS_PARAM_H = 1,
    .HAVE_MKDTEMP = 1,
    .HAVE_MKSTEMP = 1,
    .HAVE_MPROTECT = 1,
    .HAVE_MQUERY = null,
    .HAVE_MSVC_INVALID_PARAMETER_HANDLER = null,
    .HAVE_NAMELESS_LOCALES = null,
    .HAVE_NETDB_H = 1,
    .HAVE_NETINET_IN_H = 1,
    .HAVE_NEWLOCALE = 1,
    .HAVE_NL_LANGINFO = 1,
    .HAVE_OBSTACK = null,
    .HAVE_OPENAT = 1,
    .HAVE_OPENDIR = HAVE_OPENDIR,
    .HAVE_OS_H = null,
    .HAVE_PARTLY_WORKING_GETCWD = null,
    .HAVE_PATHS_H = null,
    .HAVE_PIPE = 1,
    .HAVE_PIPE2 = 1,
    .HAVE_POSIX_SPAWN = 1,
    .HAVE_POSIX_SPAWNATTR_T = 1,
    .HAVE_POSIX_SPAWN_FILE_ACTIONS_ADDCHDIR = null,
    .HAVE_POSIX_SPAWN_FILE_ACTIONS_ADDCHDIR_NP = 1,
    .HAVE_POSIX_SPAWN_FILE_ACTIONS_T = 1,
    .HAVE_PSTAT_GETPROCVM = null,
    .HAVE_PTHREAD_API = 1,
    .HAVE_PTHREAD_ATFORK = null,
    .HAVE_PTHREAD_H = 1,
    .HAVE_PTHREAD_MUTEX_RECURSIVE = null,
    .HAVE_PTHREAD_RWLOCK = null,
    .HAVE_PTHREAD_RWLOCK_RDLOCK_PREFER_WRITER = null,
    .HAVE_PTHREAD_SIGMASK = 1,
    .HAVE_PTHREAD_SPINLOCK_T = 1,
    .HAVE_PTHREAD_T = 1,
    .HAVE_RAISE = 1,
    .HAVE_RAWMEMCHR = 1,
    .HAVE_READDIR = HAVE_READDIR,
    .HAVE_READLINK = 1,
    .HAVE_REALLOCARRAY = 1,
    .HAVE_REALPATH = 1,
    .HAVE_REWINDDIR = HAVE_REWINDDIR,
    .HAVE_SAME_LONG_DOUBLE_AS_DOUBLE = null,
    .HAVE_SA_FAMILY_T = 1,
    .HAVE_SCHED_H = 1,
    .HAVE_SCHED_SETPARAM = null,
    .HAVE_SCHED_SETSCHEDULER = null,
    .HAVE_SDKDDKVER_H = null,
    .HAVE_SEARCH_H = 1,
    .HAVE_SECURE_GETENV = 1,
    .HAVE_SEMAPHORE_H = 1,
    .HAVE_SETDTABLESIZE = null,
    .HAVE_SETEGID = null,
    .HAVE_SETENV = 1,
    .HAVE_SETEUID = null,
    .HAVE_SETRLIMIT = 1,
    .HAVE_SHUTDOWN = 1,
    .HAVE_SIGACTION = 1,
    .HAVE_SIGALTSTACK = 1,
    .HAVE_SIGINFO_T = null,
    .HAVE_SIGINTERRUPT = 1,
    .HAVE_SIGNED_SIG_ATOMIC_T = null,
    .HAVE_SIGNED_WCHAR_T = null,
    .HAVE_SIGNED_WINT_T = null,
    .HAVE_SIGSET_T = 1,
    .HAVE_SIG_ATOMIC_T = 1,
    .HAVE_SLEEP = 1,
    .HAVE_SNPRINTF = 1,
    .HAVE_SNPRINTF_RETVAL_C99 = 1,
    .HAVE_SNPRINTF_TRUNCATION_C99 = 1,
    .HAVE_SOLARIS114_LOCALES = null,
    .HAVE_SPAWN_H = 1,
    .HAVE_STDINT_H = 1,
    .HAVE_STDINT_H_WITH_UINTMAX = 1,
    .HAVE_STDIO_EXT_H = 1,
    .HAVE_STDIO_H = 1,
    .HAVE_STDLIB_H = 1,
    .HAVE_STPCPY = 1,
    .HAVE_STRCHRNUL = 1,
    .HAVE_STRERROR_R = 1,
    .HAVE_STRINGS_H = 1,
    .HAVE_STRING_H = 1,
    .HAVE_STRNDUP = 1,
    .HAVE_STRNLEN = 1,
    .HAVE_STRSIGNAL = 1,
    .HAVE_STRUCT_LCONV_DECIMAL_POINT = null,
    .HAVE_STRUCT_SIGACTION_SA_SIGACTION = 1,
    .HAVE_STRUCT_SOCKADDR_STORAGE = 1,
    .HAVE_STRUCT_SOCKADDR_STORAGE_SS_FAMILY = 1,
    .HAVE_STRUCT_STAT_ST_ATIMENSEC = null,
    .HAVE_STRUCT_STAT_ST_ATIMESPEC_TV_NSEC = null,
    .HAVE_STRUCT_STAT_ST_ATIM_ST__TIM_TV_NSEC = null,
    .HAVE_STRUCT_STAT_ST_ATIM_TV_NSEC = 1,
    .HAVE_STRUCT_STAT_ST_BIRTHTIMENSEC = null,
    .HAVE_STRUCT_STAT_ST_BIRTHTIMESPEC_TV_NSEC = null,
    .HAVE_STRUCT_STAT_ST_BIRTHTIM_TV_NSEC = null,
    .HAVE_SYMLINK = 1,
    .HAVE_SYS_BITYPES_H = null,
    .HAVE_SYS_CDEFS_H = 1,
    .HAVE_SYS_INTTYPES_H = null,
    .HAVE_SYS_IOCTL_H = 1,
    .HAVE_SYS_MMAN_H = 1,
    .HAVE_SYS_PARAM_H = 1,
    .HAVE_SYS_RANDOM_H = 1,
    .HAVE_SYS_SELECT_H = 1,
    .HAVE_SYS_SINGLE_THREADED_H = 1,
    .HAVE_SYS_SOCKET_H = 1,
    .HAVE_SYS_STAT_H = 1,
    .HAVE_SYS_TIME_H = 1,
    .HAVE_SYS_TYPES_H = 1,
    .HAVE_SYS_UIO_H = 1,
    .HAVE_SYS_WAIT_H = 1,
    .HAVE_THRD_CREATE = null,
    .HAVE_THREADS_H = 1,
    .HAVE_TOWLOWER = 1,
    .HAVE_TSEARCH = 1,
    .HAVE_UNISTD_H = 1,
    .HAVE_UNSETENV = 1,
    .HAVE_UNSIGNED_LONG_LONG_INT = 1,
    .HAVE_USELOCALE = 1,
    .HAVE_VAR___PROGNAME = null,
    .HAVE_VASNPRINTF = null,
    .HAVE_VASPRINTF = 1,
    .HAVE_VFORK = null,
    .HAVE_VISIBILITY = null,
    .HAVE_WAITID = 1,
    .HAVE_WCHAR_H = 1,
    .HAVE_WCHAR_T = 1,
    .HAVE_WCRTOMB = 1,
    .HAVE_WCSLEN = 1,
    .HAVE_WCSNLEN = 1,
    .HAVE_WCTOB = 1,
    .HAVE_WCTYPE_H = 1,
    .HAVE_WCWIDTH = 1,
    .HAVE_WEAK_SYMBOLS = null,
    .HAVE_WINSOCK2_H = null,
    .HAVE_WINT_T = 1,
    .HAVE_WORKING_FSTATAT_ZERO_FLAG = null,
    .HAVE_WORKING_O_NOATIME = 1,
    .HAVE_WORKING_O_NOFOLLOW = 1,
    .HAVE_WORKING_SIGALTSTACK = 1,
    .HAVE_WORKING_USELOCALE = 1,
    .HAVE_WS2TCPIP_H = null,
    .HAVE_XLOCALE_H = null,
    .HAVE__BOOL = 1,
    .HAVE__CHSIZE = null,
    .HAVE__FSEEKI64 = null,
    .HAVE__FTELLI64 = null,
    .HAVE__SET_INVALID_PARAMETER_HANDLER = null,
    .HAVE___BUILTIN_EXPECT = 1,
    .HAVE___FPURGE = 1,
    .HAVE___FREADAHEAD = null,
    .HAVE___FREADING = 1,
    .HAVE___INLINE = 1,
    .HAVE___SECURE_GETENV = null,
    .HAVE___XPG_STRERROR_R = 1,
    .ICONV_CONST = {},
    .ICONV_FLAVOR = null,
    .LDBL_EXPBIT0_BIT = 0,
    .LDBL_EXPBIT0_WORD = 2,
    .LDBL_SIGNBIT_BIT = null,
    .LDBL_SIGNBIT_WORD = null,
    .LOCALENAME_ENHANCE_LOCALE_FUNCS = null,
    .LSEEK_PIPE_BROKEN = null,
    .LSTAT_FOLLOWS_SLASHED_SYMLINK = 1,
    .MALLOC_0_IS_NONNULL = 1,
    .MAP_ANONYMOUS = null,
    .MBRTOWC_EMPTY_INPUT_BUG = null,
    .MBRTOWC_IN_C_LOCALE_MAYBE_EILSEQ = 1,
    .MBRTOWC_NULL_ARG1_BUG = null,
    .MBRTOWC_NULL_ARG2_BUG = null,
    .MBRTOWC_NUL_RETVAL_BUG = null,
    .MBRTOWC_RETVAL_BUG = null,
    .MBRTOWC_STORES_INCOMPLETE_BUG = null,
    .MUSL_LIBC = null,
    .NDEBUG = null,
    .NEED_PRINTF_DIRECTIVE_A = null,
    .NEED_PRINTF_DIRECTIVE_F = null,
    .NEED_PRINTF_DIRECTIVE_LS = null,
    .NEED_PRINTF_DOUBLE = null,
    .NEED_PRINTF_ENOMEM = null,
    .NEED_PRINTF_FLAG_GROUPING = null,
    .NEED_PRINTF_FLAG_LEFTADJUST = null,
    .NEED_PRINTF_FLAG_ZERO = null,
    .NEED_PRINTF_INFINITE_DOUBLE = null,
    .NEED_PRINTF_INFINITE_LONG_DOUBLE = null,
    .NEED_PRINTF_LONG_DOUBLE = null,
    .NEED_PRINTF_UNBOUNDED_PRECISION = null,
    .NEED_SETLOCALE_IMPROVED = 0,
    .NEED_SETLOCALE_MTSAFE = 0,
    .NL_LANGINFO_MTSAFE = 1,
    .OPEN_TRAILING_SLASH_BUG = null,
    .PACKAGE = "m4",
    .PACKAGE_BUGREPORT = "bug-m4@gnu.org",
    .PACKAGE_NAME = "GNU M4",
    .PACKAGE_PACKAGER = null,
    .PACKAGE_PACKAGER_BUG_REPORTS = null,
    .PACKAGE_PACKAGER_VERSION = null,
    .PACKAGE_STRING = "GNU M4 " ++ version,
    .PACKAGE_TARNAME = "m4",
    .PACKAGE_URL = "https://www.gnu.org/software/m4/",
    .PACKAGE_VERSION = version,
    .PROMOTED_MODE_T = .mode_t,
    .PTHREAD_CREATE_IS_INLINE = null,
    .PTHREAD_IN_USE_DETECTION_HARD = null,
    .PTHREAD_SIGMASK_FAILS_WITH_ERRNO = null,
    .PTHREAD_SIGMASK_INEFFECTIVE = null,
    .PTHREAD_SIGMASK_UNBLOCK_BUG = null,
    .PTRDIFF_T_SUFFIX = null,
    .READLINK_TRAILING_SLASH_BUG = null,
    .READLINK_TRUNCATE_BUG = null,
    .RENAME_DEST_EXISTS_BUG = null,
    .RENAME_HARD_LINK_BUG = null,
    .RENAME_OPEN_FILE_WORKS = 1,
    .RENAME_TRAILING_SLASH_DEST_BUG = null,
    .RENAME_TRAILING_SLASH_SOURCE_BUG = null,
    .REPLACE_DIRFD = null,
    .REPLACE_FCHDIR = null,
    .REPLACE_FUNC_STAT_FILE = null,
    .REPLACE_NL_LANGINFO = null,
    .REPLACE_OPEN_DIRECTORY = null,
    .REPLACE_POSIX_SPAWN = null,
    .REPLACE_STRERROR_0 = null,
    .REPLACE_VASNPRINTF = null,
    .SETLOCALE_NULL_ALL_MTSAFE = 1,
    .SETLOCALE_NULL_ONE_MTSAFE = 1,
    .SIGALTSTACK_SS_REVERSED = null,
    .SIGNAL_SAFE_LIST = 1,
    .SIG_ATOMIC_T_SUFFIX = null,
    .SIZE_MAX = null,
    .SIZE_T_SUFFIX = null,
    .SOLARIS11 = null,
    .STACK_DIRECTION = -1,
    .STAT_MACROS_BROKEN = null,
    .STDC_HEADERS = 1,
    .STRERROR_R_CHAR_P = 1,
    .SYSCMD_SHELL = "/bin/sh",
    .TYPEOF_STRUCT_STAT_ST_ATIM_IS_STRUCT_TIMESPEC = 1,
    .USER_LABEL_PREFIX = {},
    .USE_ISOC_AND_POSIX_THREADS = null,
    .USE_ISOC_THREADS = null,
    .USE_POSIX_THREADS = null,
    .USE_POSIX_THREADS_WEAK = null,
    .USE_UNLOCKED_IO = .GNULIB_STDIO_SINGLE_THREAD,
    .USE_WINDOWS_THREADS = null,
    .VERSION = version,
    .VOID_UNSETENV = null,
    .WCHAR_T_SUFFIX = null,
    .WCRTOMB_C_LOCALE_BUG = null,
    .WCRTOMB_RETVAL_BUG = null,
    .WINDOWS_SOCKETS = null,
    .WINT_T_SUFFIX = null,
    .WITH_DMALLOC = null,
    .WORDS_BIGENDIAN = null,
    ._ALL_SOURCE = 1,
    ._DARWIN_C_SOURCE = 1,
    ._FILE_OFFSET_BITS = null,
    ._GNU_SOURCE = 1,
    ._HPUX_ALT_XOPEN_SOCKET_API = 1,
    ._ISOC11_SOURCE = null,
    ._LARGEFILE_SOURCE = null,
    ._LARGE_FILES = null,
    ._LCONV_C99 = null,
    ._MINIX = null,
    ._NETBSD_SOURCE = 1,
    ._OPENBSD_SOURCE = 1,
    ._POSIX_1_SOURCE = null,
    ._POSIX_PII_SOCKET = null,
    ._POSIX_PTHREAD_SEMANTICS = 1,
    ._POSIX_SOURCE = null,
    ._REGEX_INCLUDE_LIMITS_H = 1,
    ._REGEX_LARGE_OFFSETS = 1,
    ._TANDEM_SOURCE = 1,
    ._USE_STD_STAT = 1,
    ._XOPEN_SOURCE = null,
    .__EXTENSIONS__ = 1,
    .__GETOPT_PREFIX = null,
    .__STDC_CONSTANT_MACROS = null,
    .__STDC_LIMIT_MACROS = null,
    .__STDC_WANT_IEC_60559_ATTRIBS_EXT__ = 1,
    .__STDC_WANT_IEC_60559_BFP_EXT__ = 1,
    .__STDC_WANT_IEC_60559_DFP_EXT__ = 1,
    .__STDC_WANT_IEC_60559_FUNCS_EXT__ = 1,
    .__STDC_WANT_IEC_60559_TYPES_EXT__ = 1,
    .__STDC_WANT_LIB_EXT2__ = 1,
    .__STDC_WANT_MATH_SPEC_FUNCS__ = 1,
    .__USE_MINGW_ANSI_STDIO = 1,
    .__alpha__ = null,
    .__arm64__ = null,
    .__arm64_ilp32__ = null,
    .__arm__ = null,
    .__armhf__ = null,
    .__hppa64__ = null,
    .__hppa__ = null,
    .__i386__ = null,
    .__ia64__ = null,
    .__ia64_ilp32__ = null,
    .__m68k__ = null,
    .__mips64__ = null,
    .__mips__ = null,
    .__mipsn32__ = null,
    .__powerpc64__ = null,
    .__powerpc64_elfv2__ = null,
    .__powerpc__ = null,
    .__riscv32__ = null,
    .__riscv32_ilp32__ = null,
    .__riscv32_ilp32d__ = null,
    .__riscv32_ilp32f__ = null,
    .__riscv64__ = null,
    .__riscv64_ilp32__ = null,
    .__riscv64_ilp32d__ = null,
    .__riscv64_ilp32f__ = null,
    .__riscv64_lp64__ = null,
    .__riscv64_lp64d__ = null,
    .__riscv64_lp64f__ = null,
    .__s390__ = null,
    .__s390x__ = null,
    .__sh__ = null,
    .__sparc64__ = null,
    .__sparc__ = null,
    .__x86_64__ = 1,
    .__x86_64_x32__ = null,
    .eaccess = null,
    .gid_t = null,
    .intmax_t = null,
    .mbstate_t = null,
    .mode_t = null,
    .nlink_t = null,
    .off_t = null,
    .pid_t = null,
    .ptrdiff_t = null,
    .re_comp = .rpl_re_comp,
    .re_compile_fastmap = .rpl_re_compile_fastmap,
    .re_compile_pattern = .rpl_re_compile_pattern,
    .re_exec = .rpl_re_exec,
    .re_match = .rpl_re_match,
    .re_match_2 = .rpl_re_match_2,
    .re_search = .rpl_re_search,
    .re_search_2 = .rpl_re_search_2,
    .re_set_registers = .rpl_re_set_registers,
    .re_set_syntax = .rpl_re_set_syntax,
    .re_syntax_options = .rpl_re_syntax_options,
    .regcomp = .rpl_regcomp,
    .regerror = .rpl_regerror,
    .regexec = .rpl_regexec,
    .regfree = .rpl_regfree,
    .restrict = .__restrict__,
    .sig_atomic_t = null,
    .size_t = null,
    .socklen_t = null,
    .ssize_t = null,
    .stack_t = null,
    .uid_t = null,
    .va_copy = null,
};

const dirent_h_values =
    .{
    .GNULIB_ALPHASORT = 0,
    .GNULIB_CLOSEDIR = 1,
    .GNULIB_DIRFD = 1,
    .GNULIB_FDOPENDIR = GNULIB_FDOPENDIR,
    .GNULIB_OPENDIR = 1,
    .GNULIB_READDIR = 1,
    .GNULIB_REWINDDIR = 1,
    .GNULIB_SCANDIR = 0,
    .GUARD_PREFIX = .GL_M4,
    .HAVE_ALPHASORT = 1,
    .HAVE_CLOSEDIR = HAVE_CLOSEDIR,
    .HAVE_DECL_DIRFD = HAVE_DECL_DIRFD,
    .HAVE_DECL_FDOPENDIR = HAVE_DECL_FDOPENDIR,
    .HAVE_DIRENT_H = HAVE_DIRENT_H,
    .HAVE_FDOPENDIR = HAVE_FDOPENDIR,
    .HAVE_OPENDIR = HAVE_OPENDIR,
    .HAVE_READDIR = HAVE_READDIR,
    .HAVE_REWINDDIR = HAVE_REWINDDIR,
    .HAVE_SCANDIR = 1,
    .INCLUDE_NEXT = .include_next,
    .NEXT_DIRENT_H = .@"<dirent.h>",
    .PRAGMA_COLUMNS = null,
    .PRAGMA_SYSTEM_HEADER = .@"#pragma GCC system_header",
    .REPLACE_CLOSEDIR = 0,
    // TODO: GNU Build System sets this to 0 here, but to null in config.h. Why? Is this
    // correct?
    .REPLACE_DIRFD = 0,
    .REPLACE_FDOPENDIR = 0,
    .REPLACE_OPENDIR = 0,
};
